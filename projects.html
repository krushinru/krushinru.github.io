---
layout: page
title: Проекты
permalink: /projects/
---

<section class="section">
  <div class="projects-filter-sentence">
    <span class="sentence-text">Здесь собраны</span>
    
    <div class="filter-dropdown">
      <button class="dropdown-btn" id="statusDropdown">
        <span class="dropdown-value">все</span>
        <span class="dropdown-arrow">▼</span>
      </button>
      <div class="dropdown-menu" id="statusMenu">
        <button class="dropdown-item active" data-status="all">все</button>
        <button class="dropdown-item" data-status="active">текущие</button>
        <button class="dropdown-item" data-status="closed">закрытые</button>
      </div>
    </div>

    <span class="sentence-text">проекты, которые я</span>

    {% assign all_roles = "" | split: "" %}
    {% for project in site.projects %}
      {% for role in project.roles %}
        {% unless all_roles contains role %}
          {% assign all_roles = all_roles | push: role %}
        {% endunless %}
      {% endfor %}
    {% endfor %}

    {% for role in all_roles %}
      <span class="sentence-role" data-role="{{ role | downcase }}">{{ role | downcase }}</span>{% if forloop.last == false %}{% if forloop.rindex == 2 %} или {% else %}, {% endif %}{% endif %}
    {% endfor %}
  </div>

  <!-- Газетный грид -->
  <div class="projects-editorial-grid">
    {% assign projects = site.projects | sort: 'launch_year' | reverse %}
    {% assign column_counter = 0 %}
    
    {% for project in projects %}
      {% assign has_screenshot = false %}
      {% if project.screenshot and project.screenshot != "" %}
        {% assign has_screenshot = true %}
      {% endif %}
      
      {% assign has_icon = false %}
      {% if project.icon and project.icon != "" %}
        {% assign has_icon = true %}
      {% endif %}
      
      {% assign has_stats = false %}
      {% if project.stats and project.stats.size > 0 %}
        {% assign has_stats = true %}
      {% endif %}
      
      {% assign has_media = false %}
      {% if project.media and project.media.size > 0 %}
        {% assign has_media = true %}
      {% endif %}
      
      {% assign long_subtitle = false %}
      {% if project.subtitle and project.subtitle.size > 150 %}
        {% assign long_subtitle = true %}
      {% endif %}
      
      {% comment %} Определяем тип карточки {% endcomment %}
      {% assign card_type = "compact" %}
      {% assign card_span = 1 %}
      
      {% if has_screenshot and long_subtitle %}
        {% assign card_type = "hero" %}
        {% assign card_span = 3 %}
        {% assign column_counter = 0 %}
      {% elsif has_stats or has_media %}
        {% assign card_type = "feature" %}
        {% comment %} Если осталась 1 колонка - делаем compact {% endcomment %}
        {% if column_counter == 2 %}
          {% assign card_type = "compact" %}
          {% assign card_span = 1 %}
          {% assign column_counter = 0 %}
        {% else %}
          {% assign card_span = 2 %}
          {% assign column_counter = column_counter | plus: 2 %}
          {% if column_counter >= 3 %}
            {% assign column_counter = 0 %}
          {% endif %}
        {% endif %}
      {% else %}
        {% assign card_span = 1 %}
        {% assign column_counter = column_counter | plus: 1 %}
        {% if column_counter >= 3 %}
          {% assign column_counter = 0 %}
        {% endif %}
      {% endif %}
      
      <article class="project-editorial-card project-{{ card_type }}" 
               style="grid-column: span {{ card_span }};"
               data-status="{% if project.close_year and project.close_year != '' %}closed{% else %}active{% endif %}"
               data-roles="{{ project.roles | join: ',' | downcase }}">
        <a href="{{ project.url | relative_url }}" class="project-editorial-link">
          
          {% if card_type == "hero" %}
            <!-- Hero Layout -->
            <div class="project-hero-header">
              <h3 class="project-hero-title">{{ project.title }}</h3>
              <span class="project-hero-years">
                {% if project.launch_year %}
                  {{ project.launch_year }}
                  {% if project.close_year and project.close_year != project.launch_year %}
                    &nbsp;–&nbsp;{{ project.close_year }}
                  {% elsif project.close_year == nil or project.close_year == "" %}
                    &nbsp;–&nbsp;∞
                  {% endif %}
                {% endif %}
              </span>
            </div>
            
            {% if has_screenshot %}
            <div class="project-hero-image">
              <img src="{{ project.screenshot | relative_url }}" alt="{{ project.title }}" loading="lazy">
            </div>
            {% endif %}
            
            {% if project.subtitle %}
            <div class="project-hero-subtitle">
              {{ project.subtitle }}
            </div>
            {% endif %}
            
          {% elsif card_type == "feature" %}
            <!-- Feature Layout -->
            <div class="project-feature-inner">
              {% if has_icon %}
              <div class="project-feature-icon">
                <img src="{{ project.icon | relative_url }}" alt="{{ project.title }}" loading="lazy">
              </div>
              {% elsif has_screenshot %}
              <div class="project-feature-screenshot">
                <img src="{{ project.screenshot | relative_url }}" alt="{{ project.title }}" loading="lazy">
              </div>
              {% endif %}
              
              <div class="project-feature-content">
                <div class="project-feature-header">
                  <h3 class="project-feature-title">{{ project.title }}</h3>
                  <span class="project-feature-years">
                    {% if project.launch_year %}
                      {{ project.launch_year }}
                      {% if project.close_year and project.close_year != project.launch_year %}
                        &nbsp;–&nbsp;{{ project.close_year }}
                      {% elsif project.close_year == nil or project.close_year == "" %}
                        &nbsp;–&nbsp;∞
                      {% endif %}
                    {% endif %}
                  </span>
                </div>
                
                {% if project.subtitle %}
                <p class="project-feature-desc">{{ project.subtitle | truncate: 140 }}</p>
                {% endif %}
                
                {% if has_media %}
                <div class="project-feature-media">
                  <span class="project-feature-media-link">
                    <img src="https://www.google.com/s2/favicons?domain={{ project.media[0].url }}&sz=32" 
                         alt="{{ project.media[0].source }}" 
                         class="project-feature-media-favicon"
                         loading="lazy">
                    <span class="project-feature-media-text">{{ project.media[0].title }}</span>
                  </span>
                </div>
                {% endif %}
              </div>
            </div>
            
          {% else %}
            <!-- Compact Layout -->
            <div class="project-compact-content">
              <div class="project-compact-header">
                <h3 class="project-compact-title">{{ project.title }}</h3>
                <span class="project-compact-years">
                  {% if project.launch_year %}
                    {{ project.launch_year }}
                    {% if project.close_year and project.close_year != project.launch_year %}
                      &nbsp;–&nbsp;{{ project.close_year }}
                    {% elsif project.close_year == nil or project.close_year == "" %}
                      &nbsp;–&nbsp;∞
                    {% endif %}
                  {% endif %}
                </span>
              </div>
              
              {% if project.subtitle %}
              <p class="project-compact-desc">{{ project.subtitle | truncate: 120 }}</p>
              {% endif %}
              
              {% if has_stats %}
              <div class="project-compact-stat">
                <div class="compact-stat-value">{{ project.stats[0].value }}</div>
                <div class="compact-stat-label">{{ project.stats[0].label }}</div>
              </div>
              {% endif %}
            </div>
          {% endif %}
          
        </a>
      </article>
    {% endfor %}
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const statusDropdown = document.getElementById('statusDropdown');
  const statusMenu = document.getElementById('statusMenu');
  const projectCards = document.querySelectorAll('.project-editorial-card');
  const roleSpans = document.querySelectorAll('.sentence-role');

  let currentStatus = 'all';
  let activeRoles = new Set();

  statusDropdown.addEventListener('click', function(e) {
    e.stopPropagation();
    statusMenu.classList.toggle('active');
  });

  document.addEventListener('click', function() {
    statusMenu.classList.remove('active');
  });

  statusMenu.querySelectorAll('.dropdown-item').forEach(item => {
    item.addEventListener('click', function(e) {
      e.stopPropagation();
      
      currentStatus = this.dataset.status;
      
      statusMenu.querySelectorAll('.dropdown-item').forEach(i => i.classList.remove('active'));
      this.classList.add('active');
      
      document.querySelector('.dropdown-value').textContent = this.textContent;
      statusMenu.classList.remove('active');
      
      filterProjects();
    });
  });

  roleSpans.forEach(span => {
    span.addEventListener('click', function() {
      const role = this.dataset.role;
      
      if (activeRoles.has(role)) {
        activeRoles.delete(role);
        this.classList.remove('active');
      } else {
        activeRoles.add(role);
        this.classList.add('active');
      }
      
      filterProjects();
    });
  });

  function filterProjects() {
    projectCards.forEach(card => {
      const cardStatus = card.dataset.status;
      const cardRoles = card.dataset.roles.toLowerCase().split(',');
      
      let matchStatus = currentStatus === 'all' || cardStatus === currentStatus;
      let matchRoles = activeRoles.size === 0 || 
                      [...activeRoles].some(role => cardRoles.includes(role));
      
      if (matchStatus && matchRoles) {
        card.style.display = 'block';
      } else {
        card.style.display = 'none';
      }
    });
  }
});
</script>
